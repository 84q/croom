<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Sensor Test</title>
		<meta name="viewport" content="width=device-width">
	</head>

	<body>
		<button id="start-button">Permission</button>
		<h2>向き[deg]</h2>
		<p>a: <span id="ori-a"></span></p>
		<p>b: <span id="ori-b"></span></p>
		<p>g: <span id="ori-g"></span></p>

		<h2>加速度(重力加速度のぞく)[m/s^2]</h2>
		<p>x: <span id="acc-x"></span></p>
		<p>y: <span id="acc-y"></span></p>
		<p>z: <span id="acc-z"></span></p>

		<h2>加速度(重力加速度ふくむ)[m/s^2]</h2>
		<p>x: <span id="accG-x"></span></p>
		<p>y: <span id="accG-y"></span></p>
		<p>z: <span id="accG-z"></span></p>

		<h2>角速度[deg/s]</h2>
		<p>a: <span id="rot-a"></span></p>
		<p>b: <span id="rot-b"></span></p>
		<p>g: <span id="rot-g"></span></p>

		<script>
			const requestDeviceMotionPermission = () => {
				if (DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === "function") {
					DeviceMotionEvent.requestPermission().then(permissionState => {
						if (permissionState === 'granted') {
							window.addEventListener('devicemotion', e => {
								var acc = e.acceleration;
								var accG = e.accelerationIncludingGravity;
								var rot = e.rotationRate;
								document.getElementById("acc-x").innerHTML = acc.x.toFixed(3);
								document.getElementById("acc-y").innerHTML = acc.y.toFixed(3);
								document.getElementById("acc-z").innerHTML = acc.z.toFixed(3);
								document.getElementById("accG-x").innerHTML = accG.x.toFixed(3);
								document.getElementById("accG-y").innerHTML = accG.y.toFixed(3);
								document.getElementById("accG-z").innerHTML = accG.z.toFixed(3);
								document.getElementById("rot-a").innerHTML = rot.alpha.toFixed(3);
								document.getElementById("rot-b").innerHTML = rot.beta.toFixed(3);
								document.getElementById("rot-g").innerHTML = rot.gamma.toFixed(3);
							})
						} else {
							// 許可を得られなかった場合の処理
						}
					})
						.catch(console.error) // https通信でない場合などで許可を取得できなかった場合
				} else {
					// 上記以外のブラウザ
				}
			}

			// ボタンクリックでrequestDeviceMotionPermission実行
			const startButton = document.getElementById("start-button")
			startButton.addEventListener('click', requestDeviceMotionPermission, false)
		</script>
	</body>
</html>
